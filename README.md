# 书签有效性检测油猴脚本
A Tampermonkey script to detect the validity of browser bookmarks (exported as HTML files) and extract invalid/unreachable bookmarks.  
检测浏览器书签（HTML导出文件）有效性，提取无法访问的失效书签的油猴脚本，兼容数万级书签批量检测。

## ✨ 功能特点
- 📤 支持Chrome/Edge等Chromium内核浏览器导出的书签HTML文件解析
- 🚀 分批异步检测，兼容数万级书签，避免浏览器卡顿/无响应
- 📊 精细化进度展示：总进度、批次进度、实时统计（有效/失效书签数量）
- ⏯️ 支持暂停/继续/重置检测，灵活控制检测过程
- ⏱️ 手动请求超时控制（10秒），解决跨域请求超时无响应问题
- 🔍 自动过滤非HTTP/HTTPS链接，仅检测网页书签
- 📝 详细的失效原因提示（超时、请求失败、跨域限制等）
- 🎨 简洁美观的UI界面，支持深色模式适配
- 🛡️ 兼容UTF-8 BOM编码的书签文件，避免解析失败

## 📥 安装步骤
### 1. 安装油猴插件
首先确保浏览器已安装Tampermonkey（油猴）插件：
- Chrome/Edge/Firefox：前往[Tampermonkey官网](https://www.tampermonkey.net/)下载安装
- 国内用户可通过浏览器应用商店安装（如Edge加载项、Chrome网上应用店）

### 2. 安装脚本
#### 方法1：直接复制脚本（推荐）
1. 打开Tampermonkey插件 → 点击「新建脚本」
2. 删除默认模板代码
3. 复制本仓库中`bookmark-validator.user.js`文件的全部内容
4. 按`Ctrl+S`保存，脚本自动启用

#### 方法2：通过GitHub Raw安装
1. 进入本仓库的`bookmark-validator.user.js`文件
2. 点击「Raw」按钮
3. Tampermonkey会自动识别并弹出安装提示，点击「安装」即可

## 📋 使用教程
### 1. 导出浏览器书签
1. 打开Chrome/Edge浏览器 → 按下`Ctrl+Shift+O`打开书签管理器
2. 点击右上角「⋮」（更多选项）→ 选择「导出书签」
3. 保存为HTML文件（建议命名为`bookmarks.html`）

### 2. 运行脚本检测书签
1. 打开任意网页（如百度、谷歌首页）
2. 点击浏览器右上角Tampermonkey图标 → 选择「书签有效性检测（稳定版）」
3. 在弹出的界面中，点击「选择文件」，选择导出的书签HTML文件
4. 点击「开始检测」，等待检测完成：
   - 检测过程中可查看实时进度、批次信息、有效/失效数量
   - 支持「暂停/继续」检测，适合大批量书签检测
   - 检测完成后会弹窗汇总结果，并展示所有失效书签及原因

### 3. 查看检测结果
- 失效书签列表会显示标题、URL、失效原因（超时/请求失败/跨域等）
- 仅显示最新50个失效书签（避免DOM卡顿），总数会在列表底部提示
- 可滚动查看所有失效书签，支持复制URL/标题进行后续处理

## ⚙️ 自定义配置
脚本内置可调整的配置参数（位于脚本顶部`CONFIG`对象），可根据需求修改：
```javascript
const CONFIG = {
    batchSize: 15,          // 每批检测的书签数量（越小越稳定，建议10-20）
    requestTimeout: 10000,  // 单个请求超时时间（毫秒，建议8000-15000）
    batchDelay: 300,        // 批次间延迟（毫秒，避免请求过快被限流）
    resultUpdateInterval: 5 // 结果更新间隔（每检测N个更新一次DOM）
};
```

## ❓ 常见问题排查
### Q1: 提示「文件读取失败」或「未解析到任何书签」
- 确认书签文件是Chrome/Edge**标准导出的HTML格式**（不是其他格式如JSON）
- 检查文件是否被修改过，建议重新导出书签
- 脚本已兼容UTF-8 BOM编码，无需手动处理编码问题
- 查看「解析信息」区域：若显示「共找到0个A标签」，说明文件不是标准书签HTML

### Q2: 检测过程中卡住/无响应
- 降低`batchSize`参数（如改为10），减少单次请求压力
- 检查网络连接，确保能正常访问外部网站
- 避免同时检测数万个书签，可分批导出/检测
- 点击「暂停」后重新「继续」，恢复检测

### Q3: 部分有效书签被误判为失效
- 部分网站会拦截HEAD请求（脚本默认用HEAD请求检测），属于正常现象
- 可手动访问该书签URL确认是否真的失效
- 跨域限制可能导致部分网站检测结果不准确，不影响实际访问

### Q4: 检测速度过慢
- 增大`batchSize`（如改为20-30），减少批次数量
- 减小`batchDelay`（如改为100ms），加快批次处理速度
- 确保网络环境良好，避免高延迟/高丢包

## 📄 许可证
This project is licensed under the MIT License - see the [LICENSE](LICENSE) file for details.

## 🤝 贡献
欢迎提交Issue和Pull Request改进脚本：
1. Fork本仓库
2. 创建功能分支 (`git checkout `)
3. 提交修改 (`git commit -m 'Add `)
4. 推送到分支 (`git push origin `)
5. 打开Pull Request

## 📧 反馈
如果遇到问题或有功能建议，欢迎在GitHub Issues中提交，或联系作者。

---
### 免责声明
本脚本仅用于检测书签链接的可达性，不会收集/上传任何书签数据（所有处理均在本地完成）。检测结果仅供参考，部分网站因跨域/反爬策略可能导致误判，建议手动验证重要书签。
